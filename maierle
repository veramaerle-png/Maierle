import telebot
import schedule
import threading
import time

bot = telebot.TeleBot(" ")

@bot.message_handler(commands=['start', 'hello'])
def send_welcome(message):
    bot.reply_to(message, f'Привет! Я бот {bot.get_me().first_name}!')

@bot.message_handler(commands=['heh'])
def send_heh(message):
    try:
        count_heh = int(message.text.split()[1])
        if count_heh > 100:  # Защита от слишком большого числа
            count_heh = 100
    except (IndexError, ValueError):
        count_heh = 5
    
    bot.reply_to(message, "he" * count_heh)

def beep(chat_id):
    """Send the beep message."""
    try:
        bot.send_message(chat_id, text='Beep!')
    except Exception as e:
        print(f"Ошибка отправки сообщения: {e}")

@bot.message_handler(commands=['set'])
def set_timer(message):
    try:
        sec = int(message.text.split()[1])
        if 1 <= sec <= 86400:  # От 1 секунды до 1 дня
            schedule.every(sec).seconds.do(beep, message.chat.id).tag(str(message.chat.id))
            bot.reply_to(message, f'Таймер установлен на {sec} секунд')
        else:
            bot.reply_to(message, 'Укажите значение от 1 до 86400 секунд')
    except (IndexError, ValueError):
        bot.reply_to(message, 'Использование: /set <секунды>')

@bot.message_handler(commands=['unset'])
def unset_timer(message):
    schedule.clear(str(message.chat.id))
    bot.reply_to(message, 'Таймер остановлен')

@bot.message_handler(commands=['status'])
def check_status(message):
    jobs = schedule.get_jobs(str(message.chat.id))
    if jobs:
        bot.reply_to(message, f'Активные таймеры: {len(jobs)}')
    else:
        bot.reply_to(message, 'Нет активных таймеров')

def scheduler_loop():

    while True:
        schedule.run_pending()
        time.sleep(1)

if __name__ == '__main__':
    print("Бот запускается...")
    
    bot_thread = threading.Thread(
        target=bot.infinity_polling,
        name='TeleBot',
        daemon=True
    )
    bot_thread.start()
    
    scheduler_loop()
